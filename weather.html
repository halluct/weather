<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8">
    <title>Forecast</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Forecast enables you to get up-to-date weather information for multiple cities.">
    <meta name="author" content="summer222522">
  	<link rel="stylesheet" href="css/bootstrap.min.css" />
    <style type="text/css">
      #placeholder{
        margin: 20px;
      }
    </style>
</head>
<body>
	<div class="container">
    <div id="placeholder" style="width:600px;height:300px;"></div>
		<table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>City</th>
          <th>日期</th>
          <th>今日天气</th>
          <th>最低温度</th>
          <th>最高温度</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
	</div>
	
  <script src="js/jquery-1.7.2.min.js"></script>
	<script src="js/jquery.flot.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
      var cities = ["anshan", "aomen", "baise", "beihai", "beijing", "benxi", "changde", "changsha", "chenzhou", "chengdu", "chongqing", "dali", "dalian", "dandong", "emeishan", "erlianhaote", "foshan", "fushun", "ganzhou", "guangzhou", "guilin", "haerbin", "haicheng", "haikou", "haining", "hangzhou", "hefei", "huhehaote", "xianggang", "jinan", "jingdezhen", "jiujiang", "jiuquan", "kashi", "kaifeng", "kelamayi", "kunming", "lasa", "lanzhou", "lishui", "liuyang", "liuzhou", "luoyang", "mianyang", "mudanjiang", "nanchang", "nanjing", "nanning", "nanyang", "ningbo", "pingyao", "poyang", "qiqihaer", "sanya", "shanghai", "shaoxing", "shenyang", "shenzhen", "shijiazhuang", "suining", "taibei", "taiyuan", "tianjin", "tieling", "tulufan", "wulumuqi", "wenzhou", "wugang", "wuhan", "wutaishan", "wuzhou", "xiangtan", "yangcheng", "yangquan", "yichun", "yueyang", "yuncheng", "zhengzhou"];
      var hightTemp = [];

      var options = {
        lines: { show: true },
        points: { show: true },
        xaxis: { tickDecimals: 0, tickSize: 1 },
        yaxis: { tickDecimals: 0, tickSize: 1 }
      };
      var placeholder = $("#placeholder");
      $.plot(placeholder, [], options);
        
      $.each(cities, function(i, city) {
        $.getJSON("http://weather.china.xappengine.com/api?city=" + city + "&callback=?", function(res) {
            var forecasts = res.forecasts[0];
            var html = '<tr><td>' + res.name + '</td><td>' + forecasts.date + '</td><td>'
              +'<img src="' + forecasts.image_small + '" /><span>' + forecasts.text + '</span></td><td>' + forecasts.low + '&#8451;</td><td>' + forecasts.high + '&#8451;</td></tr>'
            $('.container').find('tbody').append(html);
            
            hightTemp.push(forecasts.high);
            drawChart(hightTemp);
          });
      });	

      function sortNumber(a,b){
        return a - b
      }

      function drawChart(hightTemp) {
        hightTemp.sort(sortNumber);
        console.log(hightTemp);

        var cityCountArray = [];
        for(var i = 0;i < hightTemp.length;){  
          var count = 0;  
          for(var j = i;j < hightTemp.length;j++){  
            if(hightTemp[i] == hightTemp[j]){  
              count ++;  
            }  
          }  
          cityCountArray.push( [hightTemp[i],count] );  
          i += count;  
        }

        for(var i = 0;i < cityCountArray.length;i++){  
          $.plot(placeholder, [cityCountArray], options);
        }
      }
		});
	</script>
</body>
</html>